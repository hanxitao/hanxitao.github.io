<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="深度克隆完整版" /><meta name="author" content="hanxitao" /><meta property="og:locale" content="en_US" /><meta name="description" content="```javascript const mapTag = ‘[object Map]’, setTag = ‘[object Set]’, arrayTag = ‘[object Array]’, objectTag = ‘[object Object]’, argsTag = ‘[object Arguments]’; 1 2 3 4 5 6 7 8 9 const boolTag = &#39;[object Boolean]&#39;, dateTag = &#39;[object Date]&#39;, numberTag = &#39;[object Number]&#39;, stringTag = &#39;[object String]&#39;, symbolTag = &#39;[object Symbol]&#39;, errorTag = &#39;[object Error]&#39;, regexpTag = &#39;[object RegExp]&#39;, funcTag = &#39;[object Function]&#39;; const deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];" /><meta property="og:description" content="```javascript const mapTag = ‘[object Map]’, setTag = ‘[object Set]’, arrayTag = ‘[object Array]’, objectTag = ‘[object Object]’, argsTag = ‘[object Arguments]’; 1 2 3 4 5 6 7 8 9 const boolTag = &#39;[object Boolean]&#39;, dateTag = &#39;[object Date]&#39;, numberTag = &#39;[object Number]&#39;, stringTag = &#39;[object String]&#39;, symbolTag = &#39;[object Symbol]&#39;, errorTag = &#39;[object Error]&#39;, regexpTag = &#39;[object RegExp]&#39;, funcTag = &#39;[object Function]&#39;; const deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];" /><link rel="canonical" href="https://hanxitao.github.io/posts/%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86%E5%AE%8C%E6%95%B4%E7%89%88/" /><meta property="og:url" content="https://hanxitao.github.io/posts/%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86%E5%AE%8C%E6%95%B4%E7%89%88/" /><meta property="og:site_name" content="Layman" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-13T14:13:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="深度克隆完整版" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@hanxitao" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"hanxitao"},"dateModified":"2021-11-13T14:13:00+08:00","datePublished":"2021-11-13T14:13:00+08:00","description":"```javascript const mapTag = ‘[object Map]’, setTag = ‘[object Set]’, arrayTag = ‘[object Array]’, objectTag = ‘[object Object]’, argsTag = ‘[object Arguments]’; 1 2 3 4 5 6 7 8 9 const boolTag = &#39;[object Boolean]&#39;, dateTag = &#39;[object Date]&#39;, numberTag = &#39;[object Number]&#39;, stringTag = &#39;[object String]&#39;, symbolTag = &#39;[object Symbol]&#39;, errorTag = &#39;[object Error]&#39;, regexpTag = &#39;[object RegExp]&#39;, funcTag = &#39;[object Function]&#39;; const deepTag = [mapTag, setTag, arrayTag, objectTag, argsTag];","headline":"深度克隆完整版","mainEntityOfPage":{"@type":"WebPage","@id":"https://hanxitao.github.io/posts/%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86%E5%AE%8C%E6%95%B4%E7%89%88/"},"url":"https://hanxitao.github.io/posts/%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86%E5%AE%8C%E6%95%B4%E7%89%88/"}</script><title>深度克隆完整版 | Layman</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Layman</a></div><div class="site-subtitle font-italic">Death is just another path, one that we all must take.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hanxitao" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>深度克隆完整版</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>深度克隆完整版</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> hanxitao </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 13, 2021, 2:13 PM +0800" prep="on" > Nov 13, 2021 <i class="unloaded">2021-11-13T14:13:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="529 words">2 min</span></div></div><div class="post-content"><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
</pre><td class="rouge-code"><pre>    <span class="kd">const</span> <span class="nx">mapTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Map]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">setTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Set]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">arrayTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Array]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">objectTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Object]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">argsTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Arguments]</span><span class="dl">'</span><span class="p">;</span>
        
    <span class="kd">const</span> <span class="nx">boolTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Boolean]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">dateTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Date]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">numberTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Number]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">stringTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object String]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">symbolTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Symbol]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">errorTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Error]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">regexpTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object RegExp]</span><span class="dl">'</span><span class="p">,</span>
        <span class="nx">funcTag</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">[object Function]</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">deepTag</span> <span class="o">=</span> <span class="p">[</span><span class="nx">mapTag</span><span class="p">,</span> <span class="nx">setTag</span><span class="p">,</span> <span class="nx">arrayTag</span><span class="p">,</span> <span class="nx">objectTag</span><span class="p">,</span> <span class="nx">argsTag</span><span class="p">];</span>

    <span class="kd">function</span> <span class="nf">forEach</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="nx">iteratee</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

        <span class="k">while </span><span class="p">(</span><span class="o">++</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">iteratee</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="nx">index</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">array</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">isObject</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">target</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">target</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">object</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">getType</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">getInit</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">Ctor</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="kd">constructor</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Ctor</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">cloneSymbol</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">Object</span><span class="p">(</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="nx">target</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">cloneReg</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">regFlags</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\w</span><span class="sr">*$/</span><span class="p">,</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">target</span><span class="p">.</span><span class="nf">constructor</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="nx">regFlags</span><span class="p">.</span><span class="nf">exec</span><span class="p">(</span><span class="nx">target</span><span class="p">));</span>
        
        <span class="nx">result</span><span class="p">.</span><span class="nx">lastIndex</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">lastIndex</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">cloneFunction</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">bodyReg</span> <span class="o">=</span> <span class="nx">bodyReg</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(?&lt;</span><span class="sr">={</span><span class="se">)(</span><span class="sr">.|</span><span class="se">\n)</span><span class="sr">+</span><span class="se">(?=)</span><span class="sr">/m</span><span class="p">,</span>
            <span class="nx">paramReg</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(?&lt;</span><span class="sr">=</span><span class="se">\()</span><span class="sr">.+</span><span class="se">(?=\)\s</span><span class="sr">+{</span><span class="se">)</span><span class="sr">/</span><span class="p">,</span>
            <span class="nx">funcString</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nf">toString</span><span class="p">();</span>
        
        <span class="k">if </span><span class="p">(</span><span class="nx">func</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">param</span> <span class="o">=</span> <span class="nx">paramReg</span><span class="p">.</span><span class="nf">exec</span><span class="p">(</span><span class="nx">funcString</span><span class="p">),</span>
                <span class="nx">body</span> <span class="o">=</span> <span class="nx">bodyReg</span><span class="p">.</span><span class="nf">exec</span><span class="p">(</span><span class="nx">funcString</span><span class="p">);</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">const</span> <span class="nx">paramArr</span> <span class="o">=</span> <span class="nx">param</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">);</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nc">Function</span><span class="p">(...</span><span class="nx">paramArr</span><span class="p">,</span> <span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nc">Function</span><span class="p">(</span><span class="nx">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">eval</span><span class="p">(</span><span class="nx">funcString</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">cloneOtherType</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">Ctor</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="kd">constructor</span><span class="p">;</span>

        <span class="k">switch</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="nx">boolTag</span><span class="p">:</span>
            <span class="k">case</span> <span class="nx">numberTag</span><span class="p">:</span>
            <span class="k">case</span> <span class="nx">stringTag</span><span class="p">:</span>
            <span class="k">case</span> <span class="nx">errorTag</span><span class="p">:</span>
            <span class="k">case</span> <span class="nx">dateTag</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nc">Ctor</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
            <span class="k">case</span> <span class="nx">regexpTag</span><span class="p">:</span>
                <span class="k">return</span> <span class="nf">cloneReg</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
            <span class="k">case</span> <span class="nx">symbolTag</span><span class="p">:</span>
                <span class="k">return</span> <span class="nf">cloneSymbol</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
            <span class="k">case</span> <span class="nx">funcTag</span><span class="p">:</span>
                <span class="k">return</span> <span class="nf">cloneFunction</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
            <span class="nl">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WeakMap</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// 克隆原始类型</span>
        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nf">isObject</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">target</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 初始化</span>
        <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nf">getType</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">cloneTarget</span><span class="p">;</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">deepTag</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">cloneTarget</span> <span class="o">=</span> <span class="nf">getInit</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">cloneOtherType</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// 防止循环引用</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">map</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">cloneTarget</span><span class="p">);</span>

        <span class="c1">// 克隆set</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">setTag</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">target</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">cloneTarget</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nf">clone</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">map</span><span class="p">));</span>
            <span class="p">});</span>
            <span class="k">return</span> <span class="nx">cloneTarget</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 克隆map</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">mapTag</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">target</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">cloneTarget</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nf">clone</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">map</span><span class="p">));</span>
            <span class="p">});</span>
            <span class="k">return</span> <span class="nx">cloneTarget</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 克隆对象和数组</span>
        <span class="kd">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="nx">type</span> <span class="o">===</span> <span class="nx">arrayTag</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
        <span class="nf">forEach</span><span class="p">(</span><span class="nx">keys</span> <span class="o">||</span> <span class="nx">target</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">keys</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">key</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">cloneTarget</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nf">clone</span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">map</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">cloneTarget</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/javascript/'>javascript</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E6%89%8B%E5%86%99/" class="post-tag no-text-decoration" >手写</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=深度克隆完整版 - Layman&url=https://hanxitao.github.io/posts/%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86%E5%AE%8C%E6%95%B4%E7%89%88/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=深度克隆完整版 - Layman&u=https://hanxitao.github.io/posts/%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86%E5%AE%8C%E6%95%B4%E7%89%88/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=深度克隆完整版 - Layman&url=https://hanxitao.github.io/posts/%E6%B7%B1%E5%BA%A6%E5%85%8B%E9%9A%86%E5%AE%8C%E6%95%B4%E7%89%88/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Vue%E4%B9%8Bdiff%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/">手写Vue2.0源码（六）-diff算法原理</a><li><a href="/posts/Vue%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%8E%9F%E7%90%86/">手写Vue2.0源码（八）-计算属性原理</a><li><a href="/posts/Vue%E6%8C%87%E4%BB%A4%E4%B9%8B%E5%8E%BB%E9%99%A4input%E5%80%BC%E4%B8%AD%E9%97%B4%E7%A9%BA%E6%A0%BC/">Vue指令之去除input值中间空格</a><li><a href="/posts/debounce-and-throttle/">防抖节流</a><li><a href="/posts/Vue%E6%B8%B2%E6%9F%93%E6%9B%B4%E6%96%B0%E5%8E%9F%E7%90%86/">手写Vue2.0源码（四）-渲染更新原理</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/everydaylearn/">EverydayLearn</a> <a class="post-tag" href="/tags/js%E7%9B%B8%E5%85%B3/">js相关</a> <a class="post-tag" href="/tags/vue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Vue源码分析</a> <a class="post-tag" href="/tags/leetcode/">LeetCode</a> <a class="post-tag" href="/tags/%E6%89%8B%E5%86%99/">手写</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/vue/">Vue</a> <a class="post-tag" href="/tags/jekyll/">jekyll</a> <a class="post-tag" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/change-this/"><div class="card-body"> <span class="timeago small" > Apr 24, 2021 <i class="unloaded">2021-04-24T22:21:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>手写call、apply和bind</h3><div class="text-muted small"><p> call、apply和bind的作用 call、apply和bind共同的作用是：改变this指向 const obj = { z: 1 }; function fn(x, y) { return x + y + this.z; } fn.call(obj, 2, 3); // 6 fn.apply(obj, [2, 3]); // 6 var bound = fn.bind(o...</p></div></div></a></div><div class="card"> <a href="/posts/%E6%89%8B%E5%86%99promise/"><div class="card-body"> <span class="timeago small" > Jul 29, 2021 <i class="unloaded">2021-07-29T19:22:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>手写Promise</h3><div class="text-muted small"><p> 一、Promise的几个关键问题 如何改变promise对象的状态？ （1）resolve(value)：如果当前是pending就会变为resolved （2）reject(reason)：如果当前是pending就会变为rejected （3）抛出异常：如果当前是pending就会变为rejected promise.t...</p></div></div></a></div><div class="card"> <a href="/posts/%E6%95%B0%E7%BB%84%E6%89%81%E5%B9%B3%E5%8C%96/"><div class="card-body"> <span class="timeago small" > Nov 15, 2021 <i class="unloaded">2021-11-15T12:57:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>数组扁平化</h3><div class="text-muted small"><p> 1、使用栈的思想实现flat函数 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 function flat(arr) { const result = [], stack = [].concat(arr); while(stack.length !== 0) { const val = stack.pop(...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E6%89%8B%E5%86%99promise/" class="btn btn-outline-primary" prompt="Older"><p>手写Promise</p></a> <a href="/posts/%E6%95%B0%E7%BB%84%E6%89%81%E5%B9%B3%E5%8C%96/" class="btn btn-outline-primary" prompt="Newer"><p>数组扁平化</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">hanxitao</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/everydaylearn/">EverydayLearn</a> <a class="post-tag" href="/tags/js%E7%9B%B8%E5%85%B3/">js相关</a> <a class="post-tag" href="/tags/vue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Vue源码分析</a> <a class="post-tag" href="/tags/leetcode/">LeetCode</a> <a class="post-tag" href="/tags/%E6%89%8B%E5%86%99/">手写</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/vue/">Vue</a> <a class="post-tag" href="/tags/jekyll/">jekyll</a> <a class="post-tag" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hanxitao.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
